{{template "header" .}}

<div class="side-app">
    <div class="page-header">
        <h4 class="page-title">Manage Blogs</h4>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/admin/dashboard">Dashboard</a></li>
            <li class="breadcrumb-item active" aria-current="page">Blogs</li>
        </ol>

    </div>
    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="card">
                <div class="card-header justify-content-between">
                    <div class="card-title">Manage Blogs</div>
                    <a href="/admin/blogs/create" class="btn btn-purple">New</a>
                </div>

                {{ template "FlashMessages" .}}

                <div class="card-body">
                    <div class="table-responsive">
                        <table id="datatable-responsive" class="table table-striped table-bordered" >
                            <thead>
                            <tr>
                                <th>Title</th>
                                <th>Detail</th>
                                <th>Category</th>
                                <th>Image</th>
                                <th style="width: 150px;">Action</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
                <!-- table-wrapper -->
            </div>
            <!-- section-wrapper -->
        </div>
    </div>
</div>

<script>

    $('document').ready(function() {
        let table = $('#datatable-responsive').DataTable( {
            "processing": true,
            "serverSide": true,
            "ajax": {
                url: "/admin/blogs/list",
                type: 'get',
            },
            "columns": [
                {data: "title", name: "Title"},
                {data: "detail", name: "Detail"},
                {data: "category.title", name: "CategoryId"},
                {data: "image", name: "Image", render: function(d, c, r) {
                        if (d)
                            return `<img src="/public/uploads/${d}" width="100" />`
                        else
                            return d;
                }},
                {data: 'action', name: 'action', orderable: false, searchable: false, className: "center-text"},
            ]
        } );

        $("body").on("click",".delete",function(e) {
            e.preventDefault();
            var id = $(this).data('id');
            var url = '/admin/blogs/xxxx/delete';

            Swal.fire({
                title: 'Are you sure ?',
                text: "You will not be able to revert this",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes Delete it'
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        url: url.replace('xxxx', id),
                        type: 'delete',
                        success: function(response) {
                            Swal.fire('Deleted!', response.message, 'success');
                            table.ajax.reload();
                        },
                        error: function (err) {
                            toast('error', 'Internal Server Error!', 'Something went wrong!');
                        }
                    });
                }//.... end if() ....//
            });
        });
    });

</script>

{{template "footer" .}}